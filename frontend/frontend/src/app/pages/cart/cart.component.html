<div class="cart-page">
    <div class="container" *ngIf="items.length > 0">
        <div class="cart-header">
            <h1>Tu Carrito de Compras</h1>
            <button class="btn-text" (click)="seguirComprando()">Seguir Comprando</button>
        </div>

        <div class="cart-grid">
            <!-- Lista de productos -->
            <div class="cart-items">
                <div class="cart-item" *ngFor="let item of items">
                    <div class="item-image">
                        <img [src]="item.imagen1 || 'assets/images/placeholder.png'" [alt]="item.marca">
                    </div>
                    <div class="item-details">
                        <h3>{{ item.marca }} <span style="font-size: 0.8em; color: #888;">(ID: {{ item.idUniforme
                                }})</span></h3>
                        <p class="item-type">{{ item.tipoPrenda }} - Talle {{ item.talle }}</p>
                        <p class="item-price">${{ item.precio | number:'1.0-0' }}</p>
                    </div>
                    <button class="btn-remove" (click)="eliminarItem(item.idUniforme)" title="Eliminar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Formulario de compra -->
            <div class="checkout-section">
                <div class="checkout-card">
                    <h2>Resumen del Pedido</h2>

                    <div class="summary-row total">
                        <span>Total a Pagar</span>
                        <span>${{ total | number:'1.0-0' }}</span>
                    </div>

                    <form #checkoutForm="ngForm" class="checkout-form">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" [(ngModel)]="cliente.nombre" name="nombre" required
                                placeholder="Tu nombre..." />
                        </div>

                        <div class="form-group">
                            <label>Teléfono (WhatsApp) *</label>
                            <input type="tel" [(ngModel)]="cliente.telefono" name="telefono" required
                                placeholder="Ej: 3513728467" />
                        </div>

                        <div class="form-group">
                            <label>DNI *</label>
                            <input type="text" [(ngModel)]="cliente.dni" name="dni" required placeholder="Tu DNI" />
                        </div>

                        <!-- Opciones de Envío -->
                        <div class="shipping-options">
                            <label>Opciones de Entrega</label>

                            <div class="method-option" [class.selected]="!conEnvio" (click)="conEnvio = false">
                                <div class="radio-circle"></div>
                                <div>
                                    <strong>Retiro en B° Villa los Llanos</strong>
                                    <p class="method-desc">Gratis</p>
                                </div>
                            </div>

                            <div class="method-option" [class.selected]="conEnvio" (click)="conEnvio = true">
                                <div class="radio-circle"></div>
                                <div>
                                    <strong>Envío a Domicilio (Dentro de anillo de Córdoba)</strong>
                                    <p class="method-desc" *ngIf="tieneEnvioGratis">
                                        <span class="badge-free">¡GRATIS!</span> (Por llevar 2+ prendas)
                                    </p>
                                    <p class="method-desc" *ngIf="!tieneEnvioGratis"> Costo: ${{ costoEnvioBase |
                                        number:'1.0-0' }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Campos de Dirección (Solo si hay envío) -->
                        <div class="address-fields" *ngIf="conEnvio">
                            <h4>Datos de Envío</h4>
                            <div class="form-row">
                                <div class="form-group half">
                                    <label>Calle *</label>
                                    <input type="text" [(ngModel)]="cliente.calle" name="calle" required
                                        placeholder="Ej: Av. Colon">
                                </div>
                                <div class="form-group half">
                                    <label>Número *</label>
                                    <input type="text" [(ngModel)]="cliente.numero" name="numero" required
                                        placeholder="1234">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Barrio *</label>
                                <input type="text" [(ngModel)]="cliente.barrio" name="barrio" required
                                    placeholder="Ej: Centro">
                            </div>
                        </div>

                        <div class="summary-section">
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span>${{ total | number:'1.0-0' }}</span>
                            </div>

                            <div class="summary-row" *ngIf="conEnvio">
                                <span>Costo de Envío</span>
                                <span *ngIf="tieneEnvioGratis" class="free-text">Sin Cargo</span>
                                <span *ngIf="!tieneEnvioGratis">${{ costoEnvioBase | number:'1.0-0' }}</span>
                            </div>

                            <div class="summary-total">
                                <span>Total Final</span>
                                <span>${{ totalFinal | number:'1.0-0' }}</span>
                            </div>

                            <div class="action-buttons">
                                <button class="btn-whatsapp" (click)="procesarVenta('Transferencia')"
                                    [disabled]="!checkoutForm.form.valid || processing">
                                    Consultar / Coordinar Pago
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <path
                                            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Estado Vacío -->
    <div class="empty-cart" *ngIf="items.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <h2>Tu carrito está vacío</h2>
        <p>¡Agrega uniformes únicos antes de que se agoten!</p>
        <button class="btn-primary" (click)="seguirComprando()">Ver Catálogo</button>
    </div>
</div>